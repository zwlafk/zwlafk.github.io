<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, å‰ç«¯, js, javascript">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="ã€canvasã€‘è®°ä¸€æ¬¡å›¾ç‰‡æ‰“ç éœ€æ±‚è°ƒç ”å»å¹´çš„ä¸€æ¬¡éœ€æ±‚ä¸­æ¶‰åŠåˆ°å›¾ç‰‡æ‰“ç åŠŸèƒ½ï¼Œæ•´ç†å¹¶è®°å½•å½“æ—¶çš„æ€è·¯ï¼Œä»¥åŠåæ¥çš„ä¸€äº›å‘æ•£æ€è€ƒã€‚    è¿™é‡Œçš„æ‰“ç éƒ½æ˜¯æŒ‡æ¯›ç»ç’ƒæ•ˆæœ(é«˜æ–¯æ¨¡ç³Š)ï¼Œä¸è¿‡æ ¹æ®æˆ‘çš„æ€è·¯é©¬èµ›å…‹æˆ–å…¶ä»–æ•ˆæœéƒ½æ˜¯å¯ä»¥å®ç°çš„ å‰è¨€æ¥ä¸‹æ¥æˆ‘ä¼šä»¥å®ç°å›¾ç‰‡æ‰“ç ä¸ºç›®æ ‡ä»‹ç»ä¸€äº›æ€è·¯å’ŒæŠ€æœ¯æ–¹æ¡ˆï¼Œåœ¨æ–‡æœ«è¿˜ä¼šä»‹ç»ä¸€äº›æœ‰è¶£çš„å›¾åƒå¤„ç†åŠŸèƒ½ï¼Œéƒ½æ˜¯åŸºäºè°ƒç ”è¿‡ç¨‹ä¸­äº†è§£åˆ°çš„apiå®ç°çš„ï¼Œæ¯”å¦‚æŠ å›¾ã€åƒå›¾æˆåƒã€ç»¿å¹•æŠ€æœ¯ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥ä¸€èµ·">
<meta property="og:type" content="website">
<meta property="og:title" content="å“‡å™»">
<meta property="og:url" content="https://zwlafk.github.io/snippets/canvas/README.html">
<meta property="og:site_name" content="å“‡å™»">
<meta property="og:description" content="ã€canvasã€‘è®°ä¸€æ¬¡å›¾ç‰‡æ‰“ç éœ€æ±‚è°ƒç ”å»å¹´çš„ä¸€æ¬¡éœ€æ±‚ä¸­æ¶‰åŠåˆ°å›¾ç‰‡æ‰“ç åŠŸèƒ½ï¼Œæ•´ç†å¹¶è®°å½•å½“æ—¶çš„æ€è·¯ï¼Œä»¥åŠåæ¥çš„ä¸€äº›å‘æ•£æ€è€ƒã€‚    è¿™é‡Œçš„æ‰“ç éƒ½æ˜¯æŒ‡æ¯›ç»ç’ƒæ•ˆæœ(é«˜æ–¯æ¨¡ç³Š)ï¼Œä¸è¿‡æ ¹æ®æˆ‘çš„æ€è·¯é©¬èµ›å…‹æˆ–å…¶ä»–æ•ˆæœéƒ½æ˜¯å¯ä»¥å®ç°çš„ å‰è¨€æ¥ä¸‹æ¥æˆ‘ä¼šä»¥å®ç°å›¾ç‰‡æ‰“ç ä¸ºç›®æ ‡ä»‹ç»ä¸€äº›æ€è·¯å’ŒæŠ€æœ¯æ–¹æ¡ˆï¼Œåœ¨æ–‡æœ«è¿˜ä¼šä»‹ç»ä¸€äº›æœ‰è¶£çš„å›¾åƒå¤„ç†åŠŸèƒ½ï¼Œéƒ½æ˜¯åŸºäºè°ƒç ”è¿‡ç¨‹ä¸­äº†è§£åˆ°çš„apiå®ç°çš„ï¼Œæ¯”å¦‚æŠ å›¾ã€åƒå›¾æˆåƒã€ç»¿å¹•æŠ€æœ¯ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥ä¸€èµ·">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/10/16f8df51f021337d?w=382&h=396&f=jpeg&s=20823">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/16/16fac1538feb1839?w=819&h=432&f=gif&s=302292">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f897b2593246c0?w=906&h=804&f=jpeg&s=143842">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f897bedd4174df?w=860&h=152&f=jpeg&s=25460">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f897c328fd786a?w=854&h=160&f=jpeg&s=24407">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f898c2dc1ccbc6?w=288&h=144&f=jpeg&s=10032">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f897ba30591d0b?w=1082&h=1036&f=jpeg&s=210051">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f897cc1e355912?w=1088&h=1006&f=jpeg&s=202121">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f897f1fc0ef6a1?w=1084&h=654&f=jpeg&s=103857">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f897f77e181a62?w=1354&h=846&f=jpeg&s=176036">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/15/16fa81f21b0f5e09?w=839&h=451&f=gif&s=1289474">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/16/16fac2bb803e4a6f?w=1438&h=1572&f=jpeg&s=260602">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f8a1dff35481ef?w=2452&h=820&f=jpeg&s=902520">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2020/1/9/16f8a303b8f62948?w=472&h=761&f=gif&s=4363867">
<meta property="og:updated_time" content="2020-04-28T10:50:10.018Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å“‡å™»">
<meta name="twitter:description" content="ã€canvasã€‘è®°ä¸€æ¬¡å›¾ç‰‡æ‰“ç éœ€æ±‚è°ƒç ”å»å¹´çš„ä¸€æ¬¡éœ€æ±‚ä¸­æ¶‰åŠåˆ°å›¾ç‰‡æ‰“ç åŠŸèƒ½ï¼Œæ•´ç†å¹¶è®°å½•å½“æ—¶çš„æ€è·¯ï¼Œä»¥åŠåæ¥çš„ä¸€äº›å‘æ•£æ€è€ƒã€‚    è¿™é‡Œçš„æ‰“ç éƒ½æ˜¯æŒ‡æ¯›ç»ç’ƒæ•ˆæœ(é«˜æ–¯æ¨¡ç³Š)ï¼Œä¸è¿‡æ ¹æ®æˆ‘çš„æ€è·¯é©¬èµ›å…‹æˆ–å…¶ä»–æ•ˆæœéƒ½æ˜¯å¯ä»¥å®ç°çš„ å‰è¨€æ¥ä¸‹æ¥æˆ‘ä¼šä»¥å®ç°å›¾ç‰‡æ‰“ç ä¸ºç›®æ ‡ä»‹ç»ä¸€äº›æ€è·¯å’ŒæŠ€æœ¯æ–¹æ¡ˆï¼Œåœ¨æ–‡æœ«è¿˜ä¼šä»‹ç»ä¸€äº›æœ‰è¶£çš„å›¾åƒå¤„ç†åŠŸèƒ½ï¼Œéƒ½æ˜¯åŸºäºè°ƒç ”è¿‡ç¨‹ä¸­äº†è§£åˆ°çš„apiå®ç°çš„ï¼Œæ¯”å¦‚æŠ å›¾ã€åƒå›¾æˆåƒã€ç»¿å¹•æŠ€æœ¯ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥ä¸€èµ·">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2020/1/10/16f8df51f021337d?w=382&h=396&f=jpeg&s=20823">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.2',
    sidebar: {"position":"left","display":"hide","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: 'NX138MH7QL',
      apiKey: '945f4cf08d7d451ed38143e208ea5784',
      indexName: 'blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"æœç´¢å…³é”®å­—","hits_empty":"å•Šå¶ï¼Œæ²¡æœ‰æ‰¾åˆ° ${query}","hits_stats":"æ‰¾åˆ°äº† ${hits} æ¡ç»“æœï¼Œè€—æ—¶ ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zwlafk.github.io/snippets/canvas/README.html">





  <title> | å“‡å™»</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å“‡å™»</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/zwl/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    
    
    
    <div class="post-block page">
      <header class="post-header">

	<h1 class="post-title" itemprop="name headline"></h1>



</header>

      
      
      
      <div class="post-body">
        
        
          <h1 id="ã€canvasã€‘è®°ä¸€æ¬¡å›¾ç‰‡æ‰“ç éœ€æ±‚è°ƒç ”"><a href="#ã€canvasã€‘è®°ä¸€æ¬¡å›¾ç‰‡æ‰“ç éœ€æ±‚è°ƒç ”" class="headerlink" title="ã€canvasã€‘è®°ä¸€æ¬¡å›¾ç‰‡æ‰“ç éœ€æ±‚è°ƒç ”"></a>ã€canvasã€‘è®°ä¸€æ¬¡å›¾ç‰‡æ‰“ç éœ€æ±‚è°ƒç ”</h1><p>å»å¹´çš„ä¸€æ¬¡éœ€æ±‚ä¸­æ¶‰åŠåˆ°å›¾ç‰‡æ‰“ç åŠŸèƒ½ï¼Œæ•´ç†å¹¶è®°å½•å½“æ—¶çš„æ€è·¯ï¼Œä»¥åŠåæ¥çš„ä¸€äº›å‘æ•£æ€è€ƒã€‚   </p>
<p><em>è¿™é‡Œçš„æ‰“ç éƒ½æ˜¯æŒ‡æ¯›ç»ç’ƒæ•ˆæœ(é«˜æ–¯æ¨¡ç³Š)ï¼Œä¸è¿‡æ ¹æ®æˆ‘çš„æ€è·¯é©¬èµ›å…‹æˆ–å…¶ä»–æ•ˆæœéƒ½æ˜¯å¯ä»¥å®ç°çš„</em></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ¥ä¸‹æ¥æˆ‘ä¼šä»¥å®ç°å›¾ç‰‡æ‰“ç ä¸ºç›®æ ‡ä»‹ç»ä¸€äº›æ€è·¯å’ŒæŠ€æœ¯æ–¹æ¡ˆï¼Œåœ¨æ–‡æœ«è¿˜ä¼šä»‹ç»ä¸€äº›æœ‰è¶£çš„å›¾åƒå¤„ç†åŠŸèƒ½ï¼Œéƒ½æ˜¯åŸºäºè°ƒç ”è¿‡ç¨‹ä¸­äº†è§£åˆ°çš„apiå®ç°çš„ï¼Œæ¯”å¦‚æŠ å›¾ã€åƒå›¾æˆåƒã€ç»¿å¹•æŠ€æœ¯ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥ä¸€èµ·äº†è§£ä¸‹ã€‚</p>
<p><em>æ–‡ä¸­æ–œä½“éƒ¨åˆ†å¤§å¤šæ˜¯åœ¨è¡¨è¿°æˆ‘è‡ªå·±çš„ç†è§£</em>   </p>
<h3 id="canvas"><a href="#canvas" class="headerlink" title="canvas"></a>canvas</h3><blockquote>
<p> HTML çš„ \<canvas> å…ƒç´ æä¾›äº†ä¸€ä¸ªç©ºç™½ç»˜å›¾åŒºåŸŸï¼Œå¯ä»¥ä½¿ç”¨ APIs ï¼ˆæ¯”å¦‚ Canvas 2D æˆ– WebGLï¼‰æ¥ç»˜åˆ¶å›¾å½¢ã€‚   </canvas></p>
</blockquote>
<p>ä»¥ä¸Šæ˜¯<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Canvas" target="_blank" rel="noopener">MDN</a>å¯¹canvasçš„ä»‹ç»ï¼Œæ—¢ç„¶æ˜¯ç”¨æ¥ç»˜åˆ¶å›¾å½¢çš„ï¼Œå¯èƒ½å¤§éƒ¨åˆ†åŒå­¦å¹¶æ²¡æœ‰æ¥è§¦è¿‡æ­¤ç±»éœ€æ±‚ï¼Œå¯¹canvaså¤„äºå¬è¿‡çœ‹è¿‡æ²¡ç”¨è¿‡çš„çŠ¶æ€ã€‚   </p>
<p>ä¸‹é¢æˆ‘æ¥å¿«é€Ÿä»‹ç»ä¸€ä¸‹å¦‚ä½•ç”¨canvasåœ¨æµè§ˆå™¨ä¸Šç»˜åˆ¶å‡ºä¸€ä¸ªå›¾å½¢ï¼Œè¿™æ ·å¤§å®¶å°±éƒ½åœ¨åŒä¸€èµ·è·‘çº¿ä¸Šäº†ã€‚</p>
<p>æˆ–è€…ä½ å¯ä»¥åœ¨MDNä¸Šäº†è§£<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Basic_usage" target="_blank" rel="noopener">canvasçš„åŸºæœ¬ç”¨æ³•</a>ç„¶åè·³è¿‡è¿™éƒ¨åˆ†ã€‚      </p>
<h3 id="å¿«é€Ÿä»‹ç»"><a href="#å¿«é€Ÿä»‹ç»" class="headerlink" title="å¿«é€Ÿä»‹ç»"></a>å¿«é€Ÿä»‹ç»</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D" target="_blank" rel="noopener">CanvasRenderingContext2D</a>(æ¸²æŸ“ä¸Šä¸‹æ–‡)æ˜¯canvasçš„ä¸€ä¸ªé‡è¦å¯¹è±¡ï¼Œé€šè¿‡åœ¨\<canvas>ä¸Šè°ƒç”¨getContext()å¹¶ä¼ å…¥ä¸€ä¸ª<code>&#39;2d&#39;</code>å‚æ•°æ¥è·å¾—ï¼Œè·å¾—è¿™ä¸ªæ¸²æŸ“ä¸Šä¸‹æ–‡åå°±å¯ä»¥å¯¹è¯¥\<canvas>ä¸Šè¿›è¡Œç»˜åˆ¶æ“ä½œäº†ã€‚<br>æ‰€ä»¥åœ¨ä½¿ç”¨canvasç»˜å›¾æ—¶ï¼Œèµ·æ‰‹æ¥ä¸€ä¸ªgetContextæ˜¯å¿…ä¸å¯å°‘çš„   </canvas></canvas></p>
<p><em><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement/getContext" target="_blank" rel="noopener">getContext()</a>è¿˜å¯ä»¥ä¼ å…¥<code>&#39;webgl&#39;</code>æ¥è·å–ä¸‰ç»´ä¸Šä¸‹æ–‡è¿›è¡Œ3dç»˜å›¾ã€‚ æ—¢ç„¶\<canvas>æ˜¯ç”»å¸ƒï¼Œæˆ‘è§‰å¾—è¿™äº›ä¸Šä¸‹æ–‡å¯ä»¥ç†è§£æˆç”»ç¬”ï¼Œ2dç”»ç¬”ç”»2dï¼Œ3dç”»ç¬”ç”»3d</canvas></em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"tutorial"</span> <span class="attr">width</span>=<span class="string">"150"</span> <span class="attr">height</span>=<span class="string">"150"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    let canvas = document.getElementById('tutorial');</span><br><span class="line">    let ctx = canvas.getContext('2d');</span><br><span class="line">    ctx.fillRect(25, 25, 100, 100);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™æ®µä»£ç å°±æ˜¯è·å–canvas2dä¸Šä¸‹æ–‡åè°ƒç”¨äº†<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fillRect" target="_blank" rel="noopener">fillRect</a>åœ¨\<canvas>ä¸Šç»˜åˆ¶äº†ä¸€ä¸ªçŸ©å½¢ï¼Œä½ç½®åœ¨\<canvas>çš„å·¦ä¸Šèµ·(25ï¼Œ25)å¤„ï¼Œé•¿å®½ä¸º100ï¼Œé»˜è®¤é¢œè‰²æ˜¯#000   </canvas></canvas></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/10/16f8df51f021337d?w=382&amp;h=396&amp;f=jpeg&amp;s=20823" alt><br>é™¤äº†ç»˜åˆ¶çŸ©å½¢å¤–ï¼Œè¿™ä¸ªæ¸²æŸ“ä¸Šä¸‹æ–‡è¿˜æä¾›äº†å…¶ä»–è®¸å¤š<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D" target="_blank" rel="noopener">API</a>ç”¨ä»¥å®ç°å„ç§ç»˜å›¾éœ€æ±‚ï¼Œæ¯”å¦‚ç»˜åˆ¶æ–‡æœ¬ã€<strong>ç»˜åˆ¶è·¯å¾„ã€ç»˜åˆ¶å›¾åƒã€åƒç´ æ§åˆ¶</strong>ã€æ—‹è½¬å˜æ¢ç­‰ï¼Œæ¥ä¸‹æ¥æˆ‘åªåœ¨ç”¨åˆ°çš„æ—¶å€™ä»‹ç»ä»–ä»¬ã€‚    </p>
<h2 id="æŠ€æœ¯æ–¹æ¡ˆ"><a href="#æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="æŠ€æœ¯æ–¹æ¡ˆ"></a>æŠ€æœ¯æ–¹æ¡ˆ</h2><p>å›¾ç‰‡æ‰“ç çš„éœ€æ±‚ç®€å•æè¿°ä¸‹å°±æ˜¯ï¼šé€šè¿‡æµè§ˆå™¨ä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œå±•ç¤ºè¯¥å›¾ç‰‡åç‚¹å‡»å›¾ç‰‡ä»»ä½•åŒºåŸŸï¼Œè¯¥åŒºåŸŸè¢«æ‰“ç ï¼Œå¯ä»¥å°†æ‰“ç åçš„å›¾ç‰‡ä¿å­˜æˆ–ä¸Šä¼    </p>
<p><em>é«˜æ–¯æ¨¡ç³Šçš„<a href="http://www.ruanyifeng.com/blog/2012/11/gaussian_blur.html" target="_blank" rel="noopener">åŸç†åŠç®—æ³•</a>è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç°æˆçš„åº“<a href="https://www.npmjs.com/package/stackblur-canvas" target="_blank" rel="noopener">stackblur</a>æ¥å¤„ç†ï¼Œéœ€è¦é©¬èµ›å…‹ç­‰å…¶ä»–æ•ˆæœä¹Ÿå¯ä»¥æ‰¾åˆ°ç›¸åº”çš„åº“</em>   </p>
<p>è¿™å°±éœ€è¦canvasèƒ½åšåˆ°ä¸‹é¢å‡ ç‚¹:    </p>
<ol>
<li>èƒ½æŠŠå›¾ç‰‡å†™å…¥canvas</li>
<li>èƒ½è·å–canvasæŒ‡å®šä½ç½®çš„åƒç´ ï¼Œèƒ½åŸåœ°ä¿®æ”¹åƒç´ å€¼æ›´å¥½</li>
<li>èƒ½ä¿å­˜å½“å‰canvasä¸ºå›¾ç‰‡æˆ–base64æ•°æ®   </li>
</ol>
<p>çœ‹ä¸€ä¸‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D" target="_blank" rel="noopener">APIåˆ—è¡¨</a>ï¼Œåˆæ­¥æ€è€ƒæŠ€æœ¯æ–¹æ¡ˆï¼š   </p>
<ol>
<li>ç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage" target="_blank" rel="noopener">drawImage()</a>å°†å›¾ç‰‡å†™å…¥\<canvas>   </canvas></li>
<li>ç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/getImageData" target="_blank" rel="noopener">getImageData()</a>è·å–åƒç´ æ•°æ®ï¼Œè¿™é‡Œå¾—åˆ°çš„æ•°æ®ä¸­åŒ…å«ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ•°ç»„çš„å…ƒç´ æ˜¯å›¾ç‰‡æ‰€æœ‰åƒç´ ç‚¹çš„rgbaå€¼ï¼Œéå†è¿™ä¸ªæ•°ç»„ï¼Œç›‘å¬mousedownå’Œmousemoveäº‹ä»¶ï¼Œæ‰¾åˆ°å¯¹åº”ä½ç½®çš„åƒç´ ç‚¹ï¼Œè®¡ç®—å¹¶ä¿®æ”¹ä¸ºæ‰“ç åçš„æ–°åƒç´ å€¼ï¼Œç”±äºæ— æ³•åŸåœ°ä¿®æ”¹ï¼Œæ‰€ä»¥ä¿®æ”¹ä¹‹åéœ€è¦é‡æ–°è°ƒç”¨drawImageï¼Œå°†æ‰“è¿‡ç åçš„å›¾åƒç»˜å…¥\<canvas></canvas></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement" target="_blank" rel="noopener">HTMLCanvasElement</a>æä¾›äº†<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement/toDataURL" target="_blank" rel="noopener">canvas.toDataURL()</a>å’Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement/toBlob" target="_blank" rel="noopener">canvas.toBlob()</a>æ–¹æ³•ï¼Œè°ƒç”¨åå¯ä»¥è·å¾—å½“å‰ç”»å¸ƒä¸­å±•ç¤ºå›¾åƒçš„base64æ•°æ®æˆ–blobå¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥å±•ç¤ºæˆ–è€…ä¸‹è½½ä¸Šä¼    </li>
</ol>
<p><em>è¿™é‡Œæåˆ°è¦ç”¨drawImageçš„åœ°æ–¹éƒ½å¯ä»¥æ›¿æ¢ä¸º<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/putImageData" target="_blank" rel="noopener">putImageData</a>ï¼ŒäºŒè€…åŒºåˆ«ä¼šåœ¨æ–‡æœ«ä»‹ç»</em></p>
<p>æ ¹æ®ä¸Šé¢çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œè½åœ°æˆä»£ç å°±æ˜¯ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥stackblur.js å¤„ç†é«˜æ–¯æ¨¡ç³ŠåŒºåŸŸ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/stackblur-canvas/2.2.0/stackblur.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas1"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line">    var canvas = document.getElementById("canvas1");</span><br><span class="line">    var context = canvas.getContext("2d");</span><br><span class="line">    var imgObj = new Image();</span><br><span class="line">    imgObj.src = '../img.jpg';</span><br><span class="line">    //å¾…å›¾ç‰‡åŠ è½½å®Œåï¼Œå°†å…¶æ˜¾ç¤ºåœ¨canvasä¸Š</span><br><span class="line">    imgObj.onload = function () &#123;</span><br><span class="line">        canvas.style.width = this.width + "px";</span><br><span class="line">        canvas.style.height = this.height + "px";</span><br><span class="line">        canvas.width = this.width;</span><br><span class="line">        canvas.height = this.height;</span><br><span class="line">        // è°ƒç”¨drawImageåœ¨canvasä¸Šç»˜åˆ¶æ­¤å›¾</span><br><span class="line">        context.drawImage(this, 0, 0, this.width, this.height);</span><br><span class="line">        // å¼€å§‹ç›‘å¬é¼ æ ‡äº‹ä»¶</span><br><span class="line">        initEventListener();</span><br><span class="line">    &#125;</span><br><span class="line">    function initEventListener() &#123;</span><br><span class="line">        canvas.onmousedown = function (ev) &#123;</span><br><span class="line">            var ev = ev || window.event;</span><br><span class="line">            var dx = ev.clientX - canvas.offsetLeft;</span><br><span class="line">            var dy = ev.clientY - canvas.offsetTop;</span><br><span class="line">            drawLine(dx, dy);</span><br><span class="line">            document.onmousemove = function (ev) &#123;</span><br><span class="line">                var ev = ev || window.event;</span><br><span class="line">                var mx = ev.clientX - canvas.offsetLeft;</span><br><span class="line">                var my = ev.clientY - canvas.offsetTop;</span><br><span class="line">                drawLine(mx, my);</span><br><span class="line">            &#125;;</span><br><span class="line">            document.onmouseup = function () &#123;</span><br><span class="line">                document.onmousemove = null;</span><br><span class="line">                document.onmouseup = null;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    function drawLine(dx, dy) &#123;</span><br><span class="line">        // åœ¨canvas è·ç¦»å·¦ä¸Šè§’dx - 15, dy - 15çš„ä½ç½®ç”Ÿæˆä¸€ä¸ªçŸ©å½¢é«˜æ–¯æ¨¡ç³ŠåŒºåŸŸï¼Œå¤§å°ä¸º30*30ï¼Œæ¨¡ç³ŠåŠå¾„ä¸º10(æ¨¡ç³ŠåŠå¾„è¶Šå¤§æ‰“ç æ•ˆæœè¶Šå¼º)</span><br><span class="line">        StackBlur.canvasRGBA(canvas, dx - 15, dy - 15, 30, 30, 10);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><em>æ–¹æ¡ˆä¸­æè¿°è°ƒç”¨getImageData()åå¤„ç†åƒç´ ç‚¹çš„æ“ä½œç”±<a href="https://github.com/flozz/StackBlur/blob/master/src/stackblur.js#L441" target="_blank" rel="noopener">StackBlur.canvasRGBA</a>å®Œæˆ</em></p>
<p>æ•ˆæœï¼š<br><img src="https://user-gold-cdn.xitu.io/2020/1/16/16fac1538feb1839?w=819&amp;h=432&amp;f=gif&amp;s=302292" alt="æ•ˆæœ"><br><a href="https://zwlafk.github.io/snippets/canvas/gaussian-blur/plan1.html">demo</a><br><a href="https://github.com/zwlafk/canvas/blob/master/gaussian-blur/plan1.html" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a></p>
<p>è™½ç„¶èƒ½ç”¨ï¼Œä½†æœ‰ä¸¤ä¸ªå°é—®é¢˜ï¼š</p>
<ol>
<li>æ¯æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªçŸ©å½¢ï¼Œå¯èƒ½åœ†å½¢æ›´ç¬¦åˆè®¾è®¡å’Œä½“éªŒ</li>
<li>é¼ æ ‡ç§»åŠ¨é€Ÿåº¦è¿‡å¿«æ—¶ï¼Œæ‰“ç è·¯å¾„ä¸è¿ç»­      </li>
</ol>
<p>è¿™ä¸¤ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¯ä»¥è§£å†³çš„ï¼š   </p>
<ol>
<li>ç¬¬ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬å¯èƒ½è¦æ·±å…¥<a href="https://www.npmjs.com/package/stackblur-canvas" target="_blank" rel="noopener">stackblur</a>å†…éƒ¨ï¼Œç®—å‡ºéœ€è¦è¿›è¡Œé«˜æ–¯æ¨¡ç³Šçš„åœ†å½¢è¾¹ç•Œåæ ‡é›†åˆï¼Œæ¨¡ç³Šå¤„ç†æ—¶åªå¤„ç†åœ†å†…çš„åƒç´ </li>
<li>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ç”±äºæˆ‘ä»¬æ¯æ¬¡å¤„ç†çš„åŒºåŸŸåªæ˜¯ä¸€ä¸ªç‚¹ï¼Œè¦è§£å†³çš„è¯éœ€è¦ä¸°å¯Œä¸€ä¸‹onmousemoveçš„é€»è¾‘ï¼Œæ¯ä¸ªç‚¹è·Ÿä¹‹å‰çš„ç‚¹ç›¸è¿ï¼Œå½¢æˆä¸€æ¡è·¯å¾„ï¼Œå¯¹è¿çº¿è·¯å¾„ä¹Ÿè¿›è¡Œæ¨¡ç³Šå¤„ç†    </li>
</ol>
<p>è¿™ä¸¤ä¸ªé—®é¢˜è§£å†³éš¾ç‚¹åœ¨äºè¦è®¡ç®—ä¸€ç³»åˆ—ç‚¹åæ ‡ç¡®å®šè¾¹ç•Œï¼Œåªå¯¹è¾¹ç•Œå†…çš„åƒç´ æ¨¡ç³Šå¤„ç†ï¼Œéœ€è¦ç”¨åˆ°é«˜ä¸­æ•°å­¦çŸ¥è¯†ï¼Œå‹¾è‚¡å®šç†ï¼Œç›¸ä¼¼ä¸‰è§’å½¢ç­‰ï¼Œéå¸¸çš„å¯æ€•   </p>
<p><em>æ¥ä¸‹æ¥æ˜¯æ¢¦å›é«˜ä¸­ç¯èŠ‚ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡çœ‹ <a href="#æ–°çš„æŠ€æœ¯æ–¹æ¡ˆ">æ–°çš„æŠ€æœ¯æ–¹æ¡ˆ</a></em>   </p>
<p>é¦–å…ˆæœ‰å¸¸é‡<code>size</code>è¡¨ç¤ºç”»ç¬”ç²—ç»†ï¼Œåœ¨mousemoveä¸­æ‹¿åˆ°ä¸¤ä¸ªç‚¹<code>P1ï¼ŒP2</code>åæ ‡å·²çŸ¥ï¼Œå¯ä»¥ç¡®å®šä¸€æ¡ç›´çº¿l: <code>y=kx+b</code>(ä¸ºäº†æ–¹ä¾¿ä»‹ç»ï¼Œæˆ‘ä»¬å‡è®¾è¿™é‡Œä»¥P1ä¸ºåŸç‚¹ï¼Œå³æ–¹ç¨‹ä¸º<code>y=kx</code>ï¼Œå®é™…ä¸­è¦å˜åŒ–åæ ‡ç³»è®¡ç®—)ï¼Œè¿™æ¡ç›´çº¿å»¶å…¶å‚ç›´æ–¹å‘å¹³ç§»<code>æ­£è´Ÿsize/2</code>å¯ä»¥ç¡®å®šä¸¤æ¡ç›´çº¿l1ï¼Œl2ï¼Œä»¥P1å’ŒP2ä¸ºåœ†å¿ƒåŠå¾„ä¸º<code>size/2</code>ç¡®å®šçš„ä¸¤ä¸ªåœ†è®°ä¸ºc1ï¼Œc2ã€‚ l1ï¼Œl2ï¼Œc1ï¼Œc2ç»„æˆçš„åŒºåŸŸå°±æ˜¯æˆ‘ä»¬è¦ç¡®å®šçš„å¾…æ¨¡ç³Šå¤„ç†çš„èŒƒå›´ï¼Œå¦‚ä¸‹å›¾ä¸­çš„èƒ¶å›Šå‹åŒºåŸŸ</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f897b2593246c0?w=906&amp;h=804&amp;f=jpeg&amp;s=143842" alt><br>å¸¸é‡<code>size/2</code>è®°åš<code>r</code>ï¼Œå¯ä»¥è¡¨ç¤ºåœ†çš„åŠå¾„å’Œç›´çº¿lå¹³ç§»çš„è·ç¦»<br>ç»è¿‡è®¡ç®—ï¼Œl1 ,l2çš„æ–¹ç¨‹å¦‚ä¸‹ï¼Œéœ€è¦åˆ†åˆ«è®¨è®ºk &gt; 0å’Œk &lt; 0çš„æƒ…å†µ:    </p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f897bedd4174df?w=860&amp;h=152&amp;f=jpeg&amp;s=25460" alt></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f897c328fd786a?w=854&amp;h=160&amp;f=jpeg&amp;s=24407" alt></p>
<p>åœ†çš„æ–¹ç¨‹æ ¹æ®ç‚¹åæ ‡<code>(x1, y1)</code>å°±å¯ä»¥ç¡®å®š:    </p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f898c2dc1ccbc6?w=288&amp;h=144&amp;f=jpeg&amp;s=10032" alt></p>
<p>ä¸‹é¢ä¸¾ä¸¤ä¸ªğŸŒ°:   </p>
<ul>
<li>ä»¥size=10, P1(0, 0), P2(10, 16)å³k&gt;0ä¸ºä¾‹:<br><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f897ba30591d0b?w=1082&amp;h=1036&amp;f=jpeg&amp;s=210051" alt></li>
<li>ä»¥size=10, P1(0, 0), P2(10, -16)å³k&lt;0ä¸ºä¾‹:<br><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f897cc1e355912?w=1088&amp;h=1006&amp;f=jpeg&amp;s=202121" alt></li>
</ul>
<p>æ¥ç€åœ¨éå†åƒç´ ç‚¹çš„æ—¶å€™ï¼ŒæŠŠåæ ‡ä»£å…¥è¿™å››ä¸ªæ–¹ç¨‹å°±å¯ä»¥åˆ¤æ–­è¯¥åƒç´ ç‚¹æ˜¯å¦åœ¨éœ€è¦æ¨¡ç³Šçš„èŒƒå›´å†…äº†ã€‚   </p>
<hr>
<p>æˆ‘ä»¬å…ˆçŸ¥éš¾è€Œé€€ï¼Œè¿™ä¸ªæ–¹æ¡ˆæš‚åˆ—ä¸ºèµ°æŠ•æ— è·¯çš„æœ€ç»ˆæ–¹æ¡ˆ ,å»æ¡å›åˆšæ‰æ€é£çš„é”®ç›˜å†çœ‹ä¸€çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D" target="_blank" rel="noopener">APIåˆ—è¡¨</a>ï¼ŒæŠŠç›®å…‰é”å®šåœ¨<code>çº¿å‹</code>å’Œ<code>è·¯å¾„</code>ä¸Šï¼š   </p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f897f1fc0ef6a1?w=1084&amp;h=654&amp;f=jpeg&amp;s=103857" alt></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f897f77e181a62?w=1354&amp;h=846&amp;f=jpeg&amp;s=176036" alt><br>çœ‹èµ·æ¥ç®€ç›´æ˜¯ä¸ºè§£å†³è¿™ä¸¤ä¸ªé—®é¢˜é‡èº«å®šåšçš„ï¼Œçº¿å‹ç«¯ç‚¹å¯ä»¥è®¾ç½®æˆåœ†å½¢ï¼Œé¼ æ ‡ç»è¿‡çš„è½¨è¿¹ç‚¹ç‚¹ç›¸è¿å¯ä»¥è¿æˆä¸€æ¡è·¯å¾„ï¼Œæ¥ä¸‹æ¥åªè¦åœ¨è·¯å¾„é‡Œå¡«å……è¿›å¯¹åº”çš„æ¨¡ç³Šå›¾åƒå°±å¯ä»¥äº†ï¼Œ<br>å¯æƒœç»˜åˆ¶è·¯å¾„çš„ç›¸å…³apiä¸­å¹¶æ²¡æœ‰æè¿™ç§è‡ªå®šä¹‰å†…å®¹çš„å¡«å……ï¼Œåªèƒ½å¯¹è·¯å¾„è¿›è¡Œçº¯è‰²å¡«å……ï¼Œæ‰€ä»¥è¿™é‡Œçš„æŠ€æœ¯æ–¹æ¡ˆæ˜¯æ— æ³•ä½¿ç”¨è·¯å¾„æ¥å®ç°éœ€æ±‚çš„    </p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä»¥è·¯å¾„ä¸ºæ ¸å¿ƒæ¥å®ç°éœ€æ±‚å—?    </p>
<p>å½“ç„¶å¯ä»¥ï¼Œæ„Ÿå—ä¸€ä¸‹ï¼Œä¸Šé¢æˆ‘ä»¬æŒ‰ä¸‹é¼ æ ‡æ¥å›åˆ’åŠ¨çš„æ—¶å€™ï¼Œåƒä¸åƒåœ¨ç”¨æ©¡çš®æ“¦å’Œåˆ®åˆ®ä¹ï¼Œå‡è®¾è¿™é‡Œæ˜¯åˆ®åˆ®ä¹çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬åˆ®å‡ºçš„å›¾åƒæ˜¯æ¨¡ç³Šåçš„å›¾åƒé‚£ä¸å°±å¤§åŠŸå‘Šæˆäº†å—    </p>
<h2 id="æ–°çš„æŠ€æœ¯æ–¹æ¡ˆ"><a href="#æ–°çš„æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="æ–°çš„æŠ€æœ¯æ–¹æ¡ˆ"></a>æ–°çš„æŠ€æœ¯æ–¹æ¡ˆ</h2><p>æˆ‘ä»¬çš„æ–°æ–¹æ¡ˆæ˜¯æŠŠè¿™ä¸ªéœ€æ±‚å½“ä½œåˆ®åˆ®ä¹æ¥åšï¼Œå¾…åˆ®æ¶‚å±‚æ˜¯åŸå§‹å›¾åƒï¼Œä¸‹é¢éœ²å‡ºçš„å¥–é¡¹æ˜¯è¢«é«˜æ–¯æ¨¡ç³Šå¤„ç†åçš„å›¾åƒï¼Œåˆ®å¼€ä»»ä½•ä½ç½®å¯¹åº”çš„éƒ½æ˜¯è¯¥éƒ¨ä½é«˜æ–¯æ¨¡ç³Šåçš„å›¾åƒã€‚    </p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬é¢ä¸´äº†ä¸¤ä¸ªæ–°çš„é—®é¢˜ï¼š     </p>
<ol>
<li>åœ¨ç½‘ä¸Šä¼—å¤šåˆ®åˆ®ä¹å®ç°æ–¹æ¡ˆä¸­ï¼Œå¥–é¡¹æ¶‚å±‚å¯ä»¥è®¾ç½®\<canvas>çš„backgroundæ¥å®ç°ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„\<canvas>æ¥å……å½“ï¼Œè¦é€‰å“ªç§æ–¹æ¡ˆ</canvas></canvas></li>
<li>æ–°æ–¹æ¡ˆä¸‹å¦‚ä½•å¾—åˆ°æœ€ç»ˆå›¾ç‰‡æ•°æ®è¿›è¡Œä¸‹è½½ä¸Šä¼        </li>
</ol>
<p>è¿™å°±éœ€è¦æˆ‘ä»¬ç¡®å®šä¸€ä»¶äº‹: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement/toDataURL" target="_blank" rel="noopener">canvas.toDataURL()</a>æ˜¯å¦ä¼šè¿åŒcanvasçš„backgroundä¸€èµ·ç”Ÿæˆbase64æ•°æ®ï¼Œå¦‚æœä¸å¯ä»¥é‚£å°±åªèƒ½é€‰ç”¨ç¬¬äºŒç§åˆ®åˆ®ä¹æ–¹æ¡ˆ: åŒcanvasï¼Œå€ŸåŠ©ç¬¬ä¸‰ä¸ªcanvasä½œä¸ºæœ€ç»ˆçš„å®¹å™¨ï¼Œè°ƒç”¨drawImage()æŒ‰é¡ºåºå†™å…¥æˆ‘ä»¬çš„å¥–é¡¹canvaså’Œæ¶‚å±‚canvasï¼Œæœ€åå¯¹è¿™ä¸ªå®¹å™¨è°ƒç”¨toDataURL()å¾—åˆ°base64æ•°æ®    </p>
<p>ç»è¿‡æµ‹è¯•backgroundæ˜¯ä¸ä¼šå†™å…¥toDataURL()ç”Ÿæˆçš„æ•°æ®é‡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æœ€ç»ˆæŠ€æœ¯æ–¹æ¡ˆå¯ä»¥ç¡®å®šä¸‹æ¥:     </p>
<ol>
<li>htmlä¸­åˆ›å»ºä¸¤ä¸ª\<canvas> åˆ†åˆ«æ˜¯ã€Œæ¶‚å±‚ã€å’Œã€Œå¥–é¡¹ã€ï¼Œæ¶‚å±‚å‘½åä¸ºupper-canvasï¼Œå¥–é¡¹å±‚å°±ç§°ä¸ºcanvasï¼Œupper-canvasç”¨ç»å¯¹å®šä½ç½®äºcanvasä¹‹ä¸Š</canvas></li>
<li>å›¾ç‰‡åŠ è½½å®Œæˆåç”¨drawImageæŠŠå›¾ç‰‡å†™å…¥upper-canvasï¼Œç”¨<a href="https://github.com/flozz/StackBlur/blob/master/dist/stackblur.js#L76" target="_blank" rel="noopener">StackBlur.image</a>å°†å›¾ç‰‡å…¨éƒ¨æ¨¡ç³Šå¤„ç†åä¹Ÿç”¨drawImageå†™å…¥canvas</li>
<li>å¯¹upper-canvasèµ‹äºˆåˆ®åˆ®ä¹åŠŸèƒ½ï¼Œå…·ä½“åŸç†å°±ä¸è®²äº†ï¼Œç½‘ä¸Šä¸€æœä¸€éº»è¢‹ã€‚ä¸»è¦å°±æ˜¯ä½¿ç”¨è·¯å¾„ï¼Œç»“åˆ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Compositing" target="_blank" rel="noopener">globalCompositeOperation</a>å±æ€§ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥æ§åˆ¶ç”»æ–°å›¾å½¢(è·¯å¾„)ä¸å·²æœ‰å›¾å½¢çš„é®ç›–ç­–ç•¥ï¼Œé€šè¿‡æŠŠå®ƒè®¾ç½®ä¸º<code>destination-out</code>æ¥å®ç°åˆ®åˆ®ä¹æ•ˆæœ </li>
<li>å€ŸåŠ©ä¸€ä¸ªå®¹å™¨\<canvas>ï¼Œè°ƒç”¨drawImageå†™å…¥canvaså’Œupper-canvasçš„å›¾åƒï¼Œè¿™ä¸ªå®¹å™¨\<canvas>è°ƒç”¨toDataURLå³å¯æ‹¿åˆ°æœ€ç»ˆå›¾ç‰‡çš„base64æ•°æ®</canvas></canvas></li>
</ol>
<p>ç”¨ä»£ç å®ç°:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/stackblur-canvas/2.2.0/stackblur.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"upper-canvas"</span> <span class="attr">style</span>=<span class="string">"position: absolute; top: 0; left: 0;"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    let upperCanvas = document.getElementById("upper-canvas"),</span><br><span class="line">        upperContext = upperCanvas.getContext("2d");</span><br><span class="line"></span><br><span class="line">        upperContext.lineCap = "round";</span><br><span class="line">        upperContext.lineJoin = "round";</span><br><span class="line">        upperContext.lineWidth = size * 2;</span><br><span class="line">        upperContext.globalCompositeOperation = "destination-out";</span><br><span class="line"></span><br><span class="line">    let x1, y1,//ç»˜åˆ¶è·¯å¾„çš„èµ·ç‚¹åæ ‡</span><br><span class="line">        size = 15;</span><br><span class="line"></span><br><span class="line">    let canvas = document.getElementById("canvas"),</span><br><span class="line">        context = canvas.getContext("2d");</span><br><span class="line">    let img = new Image();</span><br><span class="line">    img.src = '../img.jpg';</span><br><span class="line">    img.onload = function () &#123;</span><br><span class="line">        // ç»˜å…¥åŸå§‹å›¾ç‰‡</span><br><span class="line">        upperCanvas.style.width = this.width + "px";</span><br><span class="line">        upperCanvas.style.height = this.height + "px";</span><br><span class="line">        upperCanvas.width = this.width;</span><br><span class="line">        upperCanvas.height = this.height;</span><br><span class="line">        upperContext.drawImage(this, 0, 0, this.width, this.height);</span><br><span class="line"></span><br><span class="line">        // æ¨¡ç³Šå¤„ç†å›¾ç‰‡, ç»˜å…¥åº•éƒ¨å›¾ç‰‡</span><br><span class="line">        StackBlur.image(this, "canvas", 10);</span><br><span class="line"></span><br><span class="line">        tapClip();</span><br><span class="line">    &#125;;</span><br><span class="line">    function getClipArea(e, hastouch) &#123;</span><br><span class="line">        let x = hastouch ? e.targetTouches[0].pageX : e.clientX;</span><br><span class="line">        let y = hastouch ? e.targetTouches[0].pageY : e.clientY;</span><br><span class="line">        let ndom = upperCanvas;</span><br><span class="line">        while (ndom.tagName !== "BODY") &#123;</span><br><span class="line">            x -= ndom.offsetLeft;</span><br><span class="line">            y -= ndom.offsetTop;</span><br><span class="line">            ndom = ndom.parentNode;</span><br><span class="line">        &#125;</span><br><span class="line">        return &#123;</span><br><span class="line">            x: x,</span><br><span class="line">            y: y</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    function tapClip() &#123;</span><br><span class="line">        let hastouch = "ontouchstart" in window ? true : false,</span><br><span class="line">            tapstart = hastouch ? "touchstart" : "mousedown",</span><br><span class="line">            tapmove = hastouch ? "touchmove" : "mousemove",</span><br><span class="line">            tapend = hastouch ? "touchend" : "mouseup";</span><br><span class="line">        let area;</span><br><span class="line">        let x2, y2;</span><br><span class="line">        upperContext.lineCap = "round";</span><br><span class="line">        upperContext.lineJoin = "round";</span><br><span class="line">        upperContext.lineWidth = size * 2;</span><br><span class="line">        upperContext.globalCompositeOperation = "destination-out";</span><br><span class="line">        upperCanvas.addEventListener(tapstart, function (e) &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            area = getClipArea(e, hastouch);</span><br><span class="line">            x1 = area.x;</span><br><span class="line">            y1 = area.y;</span><br><span class="line">            drawLine(x1, y1);</span><br><span class="line">            this.addEventListener(tapmove, tapmoveHandler);</span><br><span class="line">            this.addEventListener(tapend, function () &#123;</span><br><span class="line">                this.removeEventListener(tapmove, tapmoveHandler);</span><br><span class="line">            &#125;);</span><br><span class="line">            function tapmoveHandler(e) &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                area = getClipArea(e, hastouch);</span><br><span class="line">                x2 = area.x;</span><br><span class="line">                y2 = area.y;</span><br><span class="line">                drawLine(x1, y1, x2, y2);</span><br><span class="line">                x1 = x2;</span><br><span class="line">                y1 = y2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    function drawLine(x1, y1, x2, y2) &#123;</span><br><span class="line">        upperContext.beginPath();</span><br><span class="line">        if (arguments.length == 2) &#123;</span><br><span class="line">            upperContext.arc(x1, y1, size, 0, 2 * Math.PI);</span><br><span class="line">            upperContext.fill();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            upperContext.moveTo(x1, y1);</span><br><span class="line">            upperContext.lineTo(x2, y2);</span><br><span class="line">            upperContext.stroke();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>å€ŸåŠ©ä¸€ä¸ªcanvasåšå®¹å™¨å®ç°ä¸‹è½½çš„ä»£ç :<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºéšè—çš„å¯ä¸‹è½½é“¾æ¥</span></span><br><span class="line">    <span class="keyword">let</span> eleLink = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">    eleLink.download = <span class="string">'filename'</span>;</span><br><span class="line">    eleLink.style.display = <span class="string">'none'</span>;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªcanvasä½œä¸ºä¸´æ—¶å®¹å™¨</span></span><br><span class="line">    <span class="keyword">let</span> tempCanvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">    <span class="keyword">let</span> tempContext = tempCanvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">    tempCanvas.width = upperCanvas.width;</span><br><span class="line">    tempCanvas.height = upperCanvas.height;</span><br><span class="line">    <span class="comment">// æŒ‰é¡ºåºç»˜å…¥ä¸¤å±‚canvas</span></span><br><span class="line">    tempContext.drawImage(canvas, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    tempContext.drawImage(upperCanvas, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// å›¾ç‰‡è½¬base64åœ°å€</span></span><br><span class="line">    eleLink.href = tempCanvas.toDataURL(<span class="string">'image/jpeg'</span>);</span><br><span class="line">    <span class="comment">// è§¦å‘ç‚¹å‡»</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(eleLink);</span><br><span class="line">    eleLink.click();</span><br><span class="line">    <span class="comment">// ç„¶åç§»é™¤é“¾æ¥</span></span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(eleLink);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ‰äº›æµè§ˆå™¨æ˜¯æ”¯æŒ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/filter" target="_blank" rel="noopener">filterå±æ€§</a>çš„, å¯ä»¥ç›´æ¥å®ç°é«˜æ–¯æ¨¡ç³Š, å¦‚æœä½ çš„ç›®æ ‡æµè§ˆå™¨æ”¯æŒçš„è¯, å¯ä»¥çœå»å¼•å…¥StackBlur    </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡ç³Šå¤„ç†å›¾ç‰‡, ç»˜å…¥åº•éƒ¨canvas</span></span><br><span class="line">canvas.style.width = <span class="keyword">this</span>.width + <span class="string">"px"</span>;</span><br><span class="line">canvas.style.height = <span class="keyword">this</span>.height + <span class="string">"px"</span>;</span><br><span class="line">canvas.width = <span class="keyword">this</span>.width;</span><br><span class="line">canvas.height = <span class="keyword">this</span>.height;</span><br><span class="line">context.filter = <span class="string">"blur(10px)"</span>;</span><br><span class="line">context.drawImage(<span class="keyword">this</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">this</span>.width, <span class="keyword">this</span>.height);</span><br><span class="line"><span class="comment">// StackBlur.image(this, "canvas", 10);</span></span><br></pre></td></tr></table></figure>
<p>æ•ˆæœ:   </p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/15/16fa81f21b0f5e09?w=839&amp;h=451&amp;f=gif&amp;s=1289474" alt></p>
<p><a href="https://zwlafk.github.io/snippets/canvas/gaussian-blur/gaussian_blur.html">demo</a><br><a href="https://github.com/zwlafk/canvas/blob/master/gaussian-blur/gaussian_blur.html" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a></p>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬çš„éœ€æ±‚å°±å®Œå…¨å®ç°äº†ï¼Œä»£ç ç»†èŠ‚æ–¹é¢è¿˜å¾ˆç²—ç³™ï¼Œæ–¹æ¡ˆæ˜¯å®Œå…¨è¡Œå¾—é€šçš„    </p>
<p>è¿™ä¸ªæ–¹æ¡ˆè·Ÿç¬¬ä¸€ç§æ–¹æ¡ˆç›¸æ¯”ï¼Œ(è¿™é‡Œå‡è®¾ç¬¬ä¸€ç§æ–¹æ¡ˆå®ç°äº†ğŸ˜…)ç¬¬ä¸€ç§æ–¹æ¡ˆåœ¨åŒä¸€ä½ç½®å¤šæ¬¡ç‚¹å‡»å…·æœ‰ã€Œç ä¸ŠåŠ ç ã€çš„ç‰¹æ€§ï¼Œè€Œåˆ®åˆ®ä¹æ–¹æ¡ˆä¸­é¼ æ ‡ç‚¹å¤šå°‘æ¬¡ï¼Œæ¨¡ç³Šç¨‹åº¦éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¤§å®¶å¦‚æœçœŸçš„æœ‰è¿™ç§éœ€æ±‚ï¼Œè¿˜æ˜¯è¦è·Ÿäº§å“ç¡®è®¤ä¸‹è¿™ä¸ªé—®é¢˜çš„ã€‚    </p>
<p>æ‰“ç éœ€æ±‚å°±åˆ°æ­¤ä¸ºæ­¢äº†ğŸ‰ï¼Œä¼˜åŒ–ä¸‹ç»†èŠ‚å°±èƒ½ä½¿ç”¨äº†ï¼Œå¦‚æœä½ è¦çš„æ•ˆæœä¸æ˜¯é«˜æ–¯æ¨¡ç³Šï¼Œç›¸ä¿¡ä½ ä¹Ÿèƒ½æŒ‰ç…§è¿™ä¸ªæ€è·¯å®Œç¾å®ç°è‡ªå·±çš„éœ€æ±‚ï¼Œä¸‹é¢æˆ‘ä¼šè¯´è¯´è¿™æ¬¡è°ƒç ”çš„ä¸€äº›æ€è€ƒä¸æ”¶è·    </p>
<hr>
<p>ä¸Šé¢æåˆ°è¿‡drawImageçš„éƒ½å¯ä»¥æ›¿æ¢ä¸ºputImageDataï¼Œä¸‹é¢æˆ‘æ¥èŠèŠä»–ä»¬çš„åŒºåˆ«</p>
<h2 id="drawImage-VS-putImageData"><a href="#drawImage-VS-putImageData" class="headerlink" title="drawImage VS putImageData"></a>drawImage VS putImageData</h2><p>äºŒè€…ä¸»è¦åŒºåˆ«åœ¨äºå¦‚æœè¦ç»˜åˆ¶çš„ç›®æ ‡åŒºåŸŸå·²ç»æœ‰äº†å›¾åƒï¼ŒdrawImageä¼šåœ¨ç›®æ ‡åŒºåŸŸå·²æœ‰å›¾åƒä¸Šç»˜åˆ¶ï¼ŒputImageDataåˆ™ä¼šæŠŠç›®æ ‡åŒºåŸŸå·²æœ‰å›¾åƒæ¸…ç©ºåå†ç»˜åˆ¶ã€‚æœ€æ˜æ˜¾çš„æ¡ˆä¾‹å°±æ˜¯å¦‚æœè¦ç»˜åˆ¶ä¸€ç‰‡é€æ˜å›¾åƒåˆ°ç›®æ ‡ä½ç½®ä¸Šï¼ŒdrawImageåæ•´ä¸ªå›¾åƒçœ‹èµ·æ¥æ˜¯æ²¡æœ‰å˜åŒ–çš„ï¼ŒputImageDataåç›®æ ‡ä½ç½®çš„å›¾åƒä¼šè¢«æ¸…ç©ºã€‚æ‰€ä»¥ä¸Šé¢è®²çš„æ–°çš„æ–¹æ¡ˆé‡Œæˆ‘ä»¬å€ŸåŠ©ç¬¬ä¸‰ä¸ªcanvasä½œä¸ºå®¹å™¨ï¼Œå¯¼å‡ºæ•°æ®ä¸‹è½½å›¾ç‰‡æ—¶åªèƒ½ä½¿ç”¨drawImageï¼ŒputImageDataè™½ç„¶ä¹Ÿä¿ç•™äº†é€æ˜éƒ¨åˆ†ï¼Œä½†æ˜¯ä¼šæŠŠä¸‹é¢çš„æ¨¡ç³Šå›¾å±‚æ¸…ç©ºã€‚</p>
<p>å¦ä¸€ä¸ªåŒºåˆ«åœ¨äºæ¥æ”¶çš„å›¾æºç±»å‹ä¸åŒï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage" target="_blank" rel="noopener">drawImage</a>ä¸»è¦æ¥æ”¶å„ç§å›¾åƒç±»htmlå…ƒç´ ï¼Œæ¯”å¦‚img, videoï¼Œæˆ–è€…å¦ä¸€ä¸ªcanvas<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/putImageData" target="_blank" rel="noopener">putImageData</a>åªèƒ½æ¥æ”¶<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ImageData" target="_blank" rel="noopener">ImageData</a>ä½œä¸ºå›¾æº<br>æ‰€ä»¥å¯ä»¥ç»“åˆä½¿ç”¨åœºæ™¯æ¥é€‰æ‹©ç»˜åˆ¶å›¾ç‰‡çš„æ–¹æ³•ï¼Œåœ¨å¤„ç†å®ŒImageDataåƒç´ æ•°æ®åç›´æ¥è°ƒç”¨putImageDataä¼šå¾ˆæ–¹ä¾¿(æ¯”å¦‚æ–¹æ¡ˆä¸€)ï¼Œå•çº¯çš„å¸Œæœ›å›¾åƒå…ƒç´ å˜æˆcanvaså°±ç›´æ¥ç”¨drawImage     </p>
<p><a href="https://jsperf.com/canvas-drawimage-vs-putimagedata/93" target="_blank" rel="noopener">åœ¨æ€§èƒ½æ–¹é¢drawImageæ˜¯æ˜æ˜¾ä¼˜äºputImageDataçš„</a><br>putImageDataç»˜å›¾æ—¶ä¼šæ¸…ç©ºç›®æ ‡åŒºåŸŸå›¾åƒï¼Œæ€§èƒ½åˆå·®ï¼Œä½†å¹¶ä¸èƒ½è¯´å®ƒä¸€æ— æ˜¯å¤„<br>å‡ ä¹ä»»ä½•å›¾ç‰‡å¤„ç†çš„åº•å±‚åŸç†éƒ½æ˜¯é€šè¿‡ä¿®æ”¹ImageDataåƒç´ æ•°æ®å®ç°çš„ï¼Œè€Œåªæœ‰putImageDataèƒ½å¤Ÿå°†ImageDataå˜æˆå›¾åƒï¼Œä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸‹ImageDataçš„ä¸€äº›åº”ç”¨</p>
<h2 id="One-more-thing"><a href="#One-more-thing" class="headerlink" title="One more thing"></a>One more thing</h2><blockquote>
<p>ImageData æ¥å£æè¿° \<canvas> å…ƒç´ çš„ä¸€ä¸ªéšå«åƒç´ æ•°æ®çš„åŒºåŸŸã€‚     </canvas></p>
</blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ImageData" target="_blank" rel="noopener">ImageData</a>çš„dataå±æ€§æ˜¯ä¸€ä¸ªUnit8ç±»å‹çš„ä¸€ç»´æ•°ç»„, æ•°ç»„å…ƒç´ æ˜¯è¿™ä¸ªå›¾åƒçš„æ¯ä¸ªåƒç´ ç‚¹çš„rgbaå€¼, æ‰€ä»¥è¿™ä¸ªæ•°ç»„ä¸­æ¯4ä¸ªå…ƒç´ è¡¨ç¤ºä¸€ä¸ªåƒç´ ç‚¹, åˆ†åˆ«ä»£è¡¨rgbaå€¼, æµè§ˆå™¨æ ¹æ®ImageDataçš„widthå’Œheightå±æ€§ç»“åˆdataæ•°ç»„æ¥ç»˜åˆ¶å›¾åƒã€‚     </p>
<p><em>rgbaæ¯ä¸ªç»´åº¦èŒƒå›´æ˜¯0-255, ä¹Ÿå¯¹åº”è¿™é‡Œçš„Unit8è¡¨ç¤ºçš„èŒƒå›´, å³[0, 2^8-1]</em></p>
<p>ä¸Šé¢æåˆ°è¿‡å›¾ç‰‡å¤„ç†çš„åº•å±‚åŸç†éƒ½æ˜¯é€šè¿‡ä¿®æ”¹ImageDataåƒç´ å®ç°çš„ï¼Œä¸‹é¢æˆ‘æ¥ä»‹ç»å‡ ä¸ªç›¸å…³åº”ç”¨    </p>
<h3 id="æŠ å›¾"><a href="#æŠ å›¾" class="headerlink" title="æŠ å›¾"></a>æŠ å›¾</h3><p>é€šè¿‡éå†å›¾åƒæ¯ä¸ªåƒç´ ç‚¹ï¼Œä¸ç›®æ ‡åƒç´ å¯¹æ¯”ï¼Œç¬¦åˆæ¡ä»¶çš„å°±æŠŠå½“å‰çš„åƒç´ ç‚¹rgbaä¸­çš„aè®¾ä¸º0ï¼Œå³é€æ˜åº¦å®Œå…¨é€æ˜ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ImageDataï¼Œè°ƒç”¨putImageDataæŠŠæ–°çš„ImageDataç»˜å…¥canvaså³å¯<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">imgObj.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    canvas.style.width = <span class="keyword">this</span>.width + <span class="string">"px"</span>;</span><br><span class="line">    canvas.style.height = <span class="keyword">this</span>.height + <span class="string">"px"</span>;</span><br><span class="line">    canvas.width = <span class="keyword">this</span>.width;</span><br><span class="line">    canvas.height = <span class="keyword">this</span>.height;</span><br><span class="line">    context.drawImage(<span class="keyword">this</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">this</span>.width, <span class="keyword">this</span>.height);</span><br><span class="line">    <span class="keyword">var</span> modifyImgData = context.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">    <span class="keyword">var</span> modifyPxData = modifyImgData.data;</span><br><span class="line">    <span class="keyword">let</span> l = modifyPxData.length / <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; l; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> r = modifyPxData[i * <span class="number">4</span> + <span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> g = modifyPxData[i * <span class="number">4</span> + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> b = modifyPxData[i * <span class="number">4</span> + <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">if</span> (r &gt; <span class="number">100</span> &amp;&amp; g &gt; <span class="number">120</span> &amp;&amp; b &gt; <span class="number">120</span>)</span><br><span class="line">            modifyPxData[i * <span class="number">4</span> + <span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    context.putImageData(modifyImgData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä»£ç æˆ‘æŠ æ‰äº†ä¸€å¼ å›¾ç‰‡ä¸­<code>r &gt; 100 &amp;&amp; g &gt; 120 &amp;&amp; b &gt; 120</code>çš„åƒç´ ï¼Œå¤§æ¦‚å°±æ˜¯å›¾ä¸­çš„å¤©ç©ºï¼Œæ•ˆæœå¦‚ä¸‹:        </p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/16/16fac2bb803e4a6f?w=1438&amp;h=1572&amp;f=jpeg&amp;s=260602" alt><br><a href="https://github.com/zwlafk/canvas/blob/master/koutu.html" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a><br><em>ä»¥åå¯ä»¥è‡ªå·±æ¢è¯ä»¶ç…§åº•è‰²äº†</em></p>
<h3 id="åƒå›¾æˆåƒ"><a href="#åƒå›¾æˆåƒ" class="headerlink" title="åƒå›¾æˆåƒ"></a>åƒå›¾æˆåƒ</h3><p><a href="https://en.wikipedia.org/wiki/Photographic_mosaic" target="_blank" rel="noopener">Photographic mosaic</a>ï¼Œç»å…¸çš„æ¡ˆä¾‹å°±æ˜¯<a href="https://bkimg.cdn.bcebos.com/pic/6159252dd42a283497b0a9d35db5c9ea14cebfd0@wm_1,g_7,k_d2F0ZXIvYmFpa2UyNzI=,xp_5,yp_5" target="_blank" rel="noopener">æ¥šé—¨çš„ä¸–ç•Œç”µå½±æµ·æŠ¥</a>      </p>
<p>äº†è§£è¿‡ImageDataååœ¨çœ‹è¿™ç§å›¾ç‰‡ï¼Œå¯ä»¥æƒ³åƒä¸€ä¸‹æ˜¯æŠŠè®¸å¤šå­å›¾ç‰‡ä½œä¸ºä¸€ä¸ªä¸ªåƒç´ æ‹¼èµ·æ¥ã€‚è¿™äº›å­å›¾ç‰‡åœ¨ç¼©å°åˆ°ä¸€å®šç¨‹åº¦æ—¶ä¼šè¡¨ç°å‡ºä¸€ä¸ªä¸»è¦é¢œè‰²ï¼Œè¿™ä¸ªé¢œè‰²ä¸åŸå›¾å¯¹åº”åƒç´ çš„rgbå€¼è¶Šæ¥è¿‘æœ€ç»ˆæ•ˆæœå°±è¶Šå¥½ã€‚ æ‰€ä»¥è¿™ä¸ªéœ€æ±‚å®ç°èµ·æ¥éœ€è¦å…ˆè·å–åŸå›¾çš„ImageDataï¼Œéå†æ¯ä¸ªåƒç´ ç‚¹ï¼Œè·å–è¯¥ç‚¹çš„rgbå€¼ï¼Œä»¥æ­¤å€¼ä¸ºæ ‡å‡†ï¼Œåœ¨å­å›¾åº“é‡Œå¯»æ‰¾é¢œè‰²æœ€æ¥è¿‘çš„å­å›¾<br>å¯¹äºå¦‚ä½•è®¡ç®—å­å›¾ä»£è¡¨çš„é¢œè‰²ï¼Œä»¥åŠé¢œè‰²ç›¸è¿‘çš„åˆ¤æ–­æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Œæˆ‘æ˜¯è¿™æ ·æƒ³çš„(å¯èƒ½å¹¶ä¸æ­£ç¡®):      </p>
<ul>
<li>è·å–å­å›¾çš„ImageDataï¼Œéå†åƒç´ æ•°æ®ï¼ŒæŠŠæ¯ä¸ªåƒç´ çš„rgbç´¯åŠ åæ±‚å’Œï¼Œå¾—åˆ°ä¸€ä¸ªå¹³å‡å€¼rï¼Œå¹³å‡å€¼gï¼Œå¹³å‡å€¼bï¼Œè¿™ä¸ªå¹³å‡å€¼ä»£è¡¨è¿™å¼ å›¾ä½œä¸ºåƒç´ ç‚¹æ—¶çš„é¢œè‰²è¡¨ç°</li>
<li>åˆ¤æ–­é¢œè‰²ç›¸è¿‘çš„åŠæ³•ï¼Œå¯¹äºrgbè¡¨ç¤ºçš„é¢œè‰²æ¥è¯´ï¼Œrgbå°±åƒä¸‰ä¸ªç»´åº¦ï¼Œå¯ä»¥æ„å»ºæˆä¸€ä¸ªç«‹æ–¹ä½“ï¼Œä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»å³å¯è¡¨ç¤ºé¢œè‰²å·®å¼‚ç¨‹åº¦ï¼Œè®¡ç®—æ–¹æ³•å’Œç«‹ä½“å‡ ä½•ä¸­ä¸€æ ·(æ±‚ä¸‰æ®µè·ç¦»å¹³æ–¹å’Œå†å¼€æ–¹): <code>Math.sqrt(dr ** 2 + dg ** 2 + db ** 2)</code>     </li>
</ul>
<p><em>è¿™é‡Œæˆ‘ä½¿ç”¨rgbæ¨¡å‹æ¥è®¡ç®—é¢œè‰²å·®å¼‚ç¨‹åº¦ï¼Œæ¢æˆhsvæ¨¡å‹æ¥è®¡ç®—ä¼šæ›´ç²¾ç¡®</em><br><em>æœ€ç»ˆæ•ˆæœè·Ÿå­å›¾ç‰‡è´¨é‡ä¹Ÿæœ‰å…³ï¼Œå­å›¾ç‰‡é¢œè‰²è¶Šå‡åŒ€æ•ˆæœè¶Šå¥½</em>   </p>
<p>æ¥ä¸‹æ¥å°±æ˜¯æŠŠæ‹¿åˆ°çš„å­å›¾ç»˜å…¥æ–°çš„å¤§å›¾é‡Œï¼Œæ‰€æœ‰çš„åŸå§‹åƒç´ éå†å®Œæˆ, è¿™å¼ å¤§å›¾å°±æ‹¼å¥½äº†    </p>
<p><em>ä¸ºäº†å‡å°‘è®¡ç®—é‡å¯ä»¥æŠŠå­å›¾å’ŒåŸå›¾å‹ç¼©ä¸€ä¸‹ï¼Œæ¯”å¦‚åŸå›¾800x800ï¼Œåœ¨ä¸å…è®¸å­å›¾é‡å¤çš„æƒ…å†µä¸‹ç»„æˆä»–éœ€è¦64ä¸‡å¼ å­å›¾ï¼Œå¦‚æœæ¯å¼ å­å›¾æ˜¯20x20çš„ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„ç»“æœå›¾ç‰‡å°±æ˜¯16000x16000(æŒ‰ä¸Šé¢æˆ‘ä»¬æåˆ°çš„1ä¸ªåƒç´ 4bytesæ¥ç®—ï¼Œè¿™å¼ å›¾å¤§å°çº¦ä¸º0.9Gï¼Œç”Ÿæˆjpgæˆ–pngä¼šæ›´å¤§)ã€‚å¦‚æœæŠŠåŸå›¾å‹ç¼©è‡³40x40ï¼Œå°±éœ€è¦1600å¼ å­å›¾ï¼Œå­å›¾å‹ç¼©è‡³20x20ï¼Œæœ€ç»ˆå›¾ç‰‡å°±æ˜¯800x800ã€‚ æ•ˆæœå½“ç„¶æ˜¯ä¸å‹ç¼©æ¯”è¾ƒå¥½ï¼Œä½†è¿™å–å†³äºä½ æ˜¯å¦æœ‰è¿™ä¹ˆå¤šå­å›¾ï¼Œç”Ÿæˆé€Ÿåº¦ä¹Ÿä¾èµ–è®¡ç®—æœºæ€§èƒ½</em>     </p>
<p>ä¸‹é¢æ˜¯æˆ‘æŠŠä¸€å¼ 800x800çš„å›¾ç‰‡æŒ‰ç…§40x40çš„åˆ†è¾¨ç‡ï¼Œå­å›¾ä¸º20x20ç”Ÿæˆäº†ä¸€å¼ æ•ˆæœå›¾ï¼Œç”±äºå›¾æºæ˜¯ä»ç™¾åº¦å›¾ç‰‡çš„æ¥å£çˆ¬æ¥çš„ï¼Œæ•°é‡æœ‰é™ï¼Œè¿™é‡Œæˆ‘æŒ‰ç…§å¯ä»¥é‡å¤ä½¿ç”¨çš„ç­–ç•¥æ¥ç”Ÿæˆï¼Œæ‰€ä»¥æ•ˆæœå¹¶ä¸å¤ªå¥½ï¼Œä¸è¿‡æœ‰ä¸ªâ€œé€ å‡â€çš„åŠæ³•ï¼Œå°±æ˜¯æŠŠåŸå›¾è®¾ç½®ä¸€å®šçš„é€æ˜åº¦å†ç”»åˆ°ç»“æœå›¾ä¸Šã€‚   </p>
<p>ä¸‹å›¾å·¦è‡³å³åˆ†åˆ«æ˜¯ åŸå›¾ï¼Œç»“æœå›¾ï¼Œé€ å‡å›¾ï¼š    </p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f8a1dff35481ef?w=2452&amp;h=820&amp;f=jpeg&amp;s=902520" alt><br>è¿™é‡Œæˆ‘ç”¨äº†ç™¾åº¦å›¾ç‰‡çš„æœç´¢æ¥å£æ¥è·å–å­å›¾æºï¼Œä¸ºäº†æŠŠè¯·æ±‚æ¥çš„å›¾ç‰‡æ•°æ®è½åœ°åˆ°æœ¬åœ°ä»¥æ–¹ä¾¿è°ƒç”¨ï¼Œè€Œä¸”è¦è¿›è¡Œå¤§é‡çš„è®¡ç®—ï¼Œè¿™éƒ¨åˆ†æˆ‘å°±ç”¨nodejsæ¥å†™äº†ã€‚nodeåªæ˜¯jsçš„è¿è¡Œç¯å¢ƒï¼Œæ²¡æœ‰åˆ›å»ºDOMå’Œä½¿ç”¨DOM apiçš„èƒ½åŠ›ï¼Œæ‰€ä»¥éœ€è¦é¢å¤–å®‰è£…<a href="https://www.npmjs.com/package/canvas" target="_blank" rel="noopener">canvas</a>åº“æ¥æ»¡è¶³éœ€è¦ï¼Œç”¨æ³•å’Œåœ¨æµè§ˆå™¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œ<a href="https://github.com/zwlafk/canvas/tree/master/photo-mosaik" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>   </p>
<p>æˆ‘æ„Ÿè§‰åšå¥½è¿™å‡ ç‚¹ä¼šæœ‰æ›´å¥½çš„æ•ˆæœï¼š    </p>
<ul>
<li>åˆ¤æ–­é¢œè‰²ç›¸è¿‘çš„ç­–ç•¥(å­å›¾rgbå¹³å‡å€¼ä»£è¡¨å®ƒä½œä¸ºåƒç´ çš„é¢œè‰²æ˜¯å¦ç§‘å­¦ï¼›è®¡ç®—é¢œè‰²å·®å¼‚ç¨‹åº¦æ—¶ä½¿ç”¨hsvæ¨¡å‹æ›¿ä»£rgbæ¨¡å‹)</li>
<li>å­å›¾ç‰‡é¢œè‰²æœ€å¥½å‡åŒ€</li>
<li>ç»“æœä¸åŸå›¾çš„å‹ç¼©ç¨‹åº¦å°½å¯èƒ½å°</li>
<li>æˆ‘çš„æ–¹æ¡ˆè¿˜å¾ˆä¸æˆç†Ÿï¼Œå­å›¾å…¨éƒ¨æˆªæˆäº†æ­£æ–¹å½¢ä»¥æ–¹ä¾¿ä¸åŸå›¾åƒç´ ä¸€ä¸€å¯¹åº”ï¼Œä¼šä¸ä¼šæœ‰ç®—æ³•å¯ä»¥ä½¿ç”¨ä¸€å¼ å­å›¾å¯¹åº”ä¸Šå¤šä¸ªåŸå›¾åƒç´ ç‚¹</li>
</ul>
<h3 id="ã€Œç»¿å¹•ã€"><a href="#ã€Œç»¿å¹•ã€" class="headerlink" title="ã€Œç»¿å¹•ã€"></a>ã€Œç»¿å¹•ã€</h3><p>è¿™é‡Œæ˜¯<a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Manipulating_video_using_canvas" target="_blank" rel="noopener">MDNä¸Šä»‹ç»çš„åº”ç”¨</a>ï¼Œä¸»è¦æ˜¯åˆ©ç”¨äº†drawImageå¯ä»¥ç”¨videoä½œä¸ºå›¾åƒæºè¿™ä¸€ç‰¹ç‚¹ï¼Œå¯¹è§†é¢‘çš„æ¯ä¸€å¸§åšå¤„ç†ï¼ŒæŠŠæ¯å¸§çš„ImageDataä¸­ç‰¹å®šè‰²å€¼(ç»¿è‰²)çš„åƒç´ é€æ˜åº¦æ›¿æ¢ä¸º0(å®Œå…¨é€æ˜)ï¼Œå†ç”»åˆ°å¦ä¸€ä¸ªcanvasä¸Šï¼Œå°±å®ç°äº†ä»¥ç‰¹å®šå›¾åƒæ›¿æ¢ã€Œç»¿å¹•ã€çš„æ•ˆæœï¼Œåˆ©ç”¨è¿™ä¸ªæ€è·¯æˆ‘æŠŠä¸¤ä¸ªè§†é¢‘åˆæˆèµ·æ¥:    </p>
<p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f8a303b8f62948?w=472&amp;h=761&amp;f=gif&amp;s=4363867" alt><br><a href="https://zwlafk.github.io/snippets/canvas/green-screen/demo.html">demo</a><br><a href="https://github.com/zwlafk/canvas/blob/master/green-screen/demo.html" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a>    </p>
<p><em>è”æƒ³ä¸€ä¸‹ä¸€äº›æ’­æ”¾å™¨çš„å¯¼å…¥å­—å¹•åŠŸèƒ½ï¼Œå¯èƒ½ä¹Ÿæ˜¯è¿™ä¸ªåŸç†æŠŠå­—å¹•ç»˜åˆ¶åˆ°æ­£åœ¨æ’­æ”¾çš„è§†é¢‘ä¸Šçš„</em></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€åˆæ‹¿åˆ°éœ€æ±‚ä¸€é¡¿ç™¾åº¦è°·æ­Œï¼Œæƒ³æ‰¾ä¸€ä¸ªç¬¬ä¸‰æ–¹æ’ä»¶æ¥å®ç°ï¼Œç°åœ¨å›è¿‡å¤´çœ‹å®ç°èµ·æ¥æ˜¯å¾ˆç®€å•çš„ã€‚è‡ªæˆ‘åçœä¸€ä¸‹é•¿ä¹…ä»¥æ¥çš„è°ƒåŒ…ä¾ è¡Œä¸ºè®©è‡ªå·±å˜å¾—ä¸é‡è§†æ€è€ƒï¼Œä»¥åç”¨åŒ…æˆ–æ¡†æ¶è¿˜æ˜¯éœ€è¦ç»“åˆéœ€æ±‚è®¤çœŸæ€è€ƒä¸‹æ˜¯ä¸æ˜¯çœŸçš„éœ€è¦å®ƒã€‚ï¼ˆå¦‚æœå½“æ—¶æ‰¾åˆ°äº†æ’ä»¶é‚£ä¹Ÿé¦™å•Šï¼‰    </p>
<p>æœ€åè¿™éƒ¨åˆ†å°åŠŸèƒ½çš„ä»‹ç» æ„ä¹‰å¹¶ä¸åœ¨äºå‰ç«¯ä¹Ÿèƒ½æŠŠpå›¾ï¼ŒæŠ å›¾ï¼Œè§†é¢‘åˆæˆä¹‹ç±»çš„åŠŸèƒ½æ¬åˆ°æµè§ˆå™¨ä¸Šï¼Œæˆ‘è§‰å¾—æ›´å¤šåœ¨äºäº†è§£è¿™äº›åŠŸèƒ½èƒŒåçš„åŸç†ï¼Œäº†è§£pså’Œè§†é¢‘å‰ªè¾‘è½¯ä»¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæ¯•ç«Ÿè¿™äº›æ“ä½œåœ¨æµè§ˆå™¨ä¸Šä¼šå ç”¨å¾ˆé«˜çš„CPUå’ŒGPUï¼Œä¸è¿‡éšç€ç½‘ç»œå’Œç¡¬ä»¶è®¾å¤‡çš„ä¸æ–­å‡çº§ï¼Œç›¸ä¿¡æœ‰ä¸€å¤©è¿™äº›åŠŸèƒ½ä¹Ÿèƒ½åœ¨æµè§ˆå™¨ä¸Šæµç•…çš„è¿è¡Œ</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Canvas" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Glossary/Canvas</a></li>
<li><a href="https://github.com/flozz/StackBlur/blob/master/src/stackblur.js" target="_blank" rel="noopener">https://github.com/flozz/StackBlur/blob/master/src/stackblur.js</a></li>
<li><a href="https://www.cnblogs.com/puyongsong/p/6027533.html" target="_blank" rel="noopener">https://www.cnblogs.com/puyongsong/p/6027533.html</a></li>
<li><a href="https://juejin.im/post/5bdeb357e51d4536140fc7df" target="_blank" rel="noopener">https://juejin.im/post/5bdeb357e51d4536140fc7df</a></li>
<li><a href="https://github.com/WebKit/webkit/blob/master/Source/WebCore/html/HTMLCanvasElement.cpp" target="_blank" rel="noopener">https://github.com/WebKit/webkit/blob/master/Source/WebCore/html/HTMLCanvasElement.cpp</a></li>
<li><a href="https://stackoverflow.com/questions/7721898/is-putimagedata-faster-than-drawimage" target="_blank" rel="noopener">https://stackoverflow.com/questions/7721898/is-putimagedata-faster-than-drawimage</a></li>
<li><a href="https://blog.csdn.net/qidu1998/article/details/79062663" target="_blank" rel="noopener">https://blog.csdn.net/qidu1998/article/details/79062663</a></li>
</ul>
<hr>
<p><a href="https://github.com/zwlafk/canvas" target="_blank" rel="noopener">githubåœ°å€</a></p>

        
      </div>
      
      
      
    </div>
    
    
    
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image" src="/images/me.jpeg" alt="zwlafk">
          
            <p class="site-author-name" itemprop="name">zwlafk</p>
            <p class="site-description motion-element" itemprop="description">å‰ç«¯</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zwlafk" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/your-user-name" target="_blank" title="å¾®åš">
                  
                    <i class="fa fa-fw fa-globe"></i>å¾®åš</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ã€canvasã€‘è®°ä¸€æ¬¡å›¾ç‰‡æ‰“ç éœ€æ±‚è°ƒç ”"><span class="nav-number">1.</span> <span class="nav-text">ã€canvasã€‘è®°ä¸€æ¬¡å›¾ç‰‡æ‰“ç éœ€æ±‚è°ƒç ”</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å‰è¨€"><span class="nav-number">1.1.</span> <span class="nav-text">å‰è¨€</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#canvas"><span class="nav-number">1.1.1.</span> <span class="nav-text">canvas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¿«é€Ÿä»‹ç»"><span class="nav-number">1.1.2.</span> <span class="nav-text">å¿«é€Ÿä»‹ç»</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æŠ€æœ¯æ–¹æ¡ˆ"><span class="nav-number">1.2.</span> <span class="nav-text">æŠ€æœ¯æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ–°çš„æŠ€æœ¯æ–¹æ¡ˆ"><span class="nav-number">1.3.</span> <span class="nav-text">æ–°çš„æŠ€æœ¯æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#drawImage-VS-putImageData"><span class="nav-number">1.4.</span> <span class="nav-text">drawImage VS putImageData</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#One-more-thing"><span class="nav-number">1.5.</span> <span class="nav-text">One more thing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æŠ å›¾"><span class="nav-number">1.5.1.</span> <span class="nav-text">æŠ å›¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åƒå›¾æˆåƒ"><span class="nav-number">1.5.2.</span> <span class="nav-text">åƒå›¾æˆåƒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ã€Œç»¿å¹•ã€"><span class="nav-number">1.5.3.</span> <span class="nav-text">ã€Œç»¿å¹•ã€</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">1.6.</span> <span class="nav-text">æ€»ç»“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‚è€ƒ"><span class="nav-number">1.7.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zwlafk</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
